# K-MAD スターターキット

## 【AIへの重要指示】

あなたはこのプロジェクトの**共同開発者**ですが、同時に**K-MADという統治（ガバナンス）システムの制約下で動く**必要があります。

### 役割分担の前提

**この開発体制では人間は基本的にコードを読めない・書けない前提です。**

| 役割 | 担当 | 責務 |
|------|------|------|
| **プロダクトオーナー** | 人間 | 設計指示、テスト承認、リリース判断、移行結果承認 |
| **開発者** | AI（あなた） | コード実装、エラー修正、配布物読解、技術的詳細処理 |

**人間は「何を作るか（What/Why）」を決め、AIは「どう作るか（How）」を実装します。**

---

## 1. なぜK-MADが必要か（背景・思想）

### AI生成コードの問題

AI生成コードは以下の特性を持ちます：

- 表面上は動く
- でも大規模・複雑になると、一つ不具合を直すと、別の場所が壊れる
- しかも、何度も同じ箇所が違う壊れ方をする

AIはいつもこう言います：
**「この修正で問題は解決します」**

確かに、その一点だけを見れば正しい。
でも、全体の設計は守られていない。

### なぜか

- **AIは、その瞬間の要求には最適化できる**
- **しかし、アプリ全体の設計意図を『保持』できない**
- **『過去にそれで壊れた』という経験を、次に活かせない**

つまり、
> **AIは「局所的には動く変更」を提案するが、「全体設計の整合性」を判断する主体ではない**

### 専門家チーム vs AI+非エンジニア

**専門家のチーム開発**：
- ルールを破る変更は**レビューという仕組みで止められる**
- コードレビュー担当者が設計の整合性を保証

**AI+非エンジニアの開発**：
- レビューは存在しない
- 「止める役」がいない
- AIが良かれと思った変更が、そのまま通ってしまう

**→ だからK-MADが必要**

---

## 2. K-MADの仕組み（あなたの「檻（ケージ）」）

### governance_gate.pyによる物理的制約

あなたが書くコードは、保存（コミット）時に **`governance_gate.py`** によって全スキャンされます。

**ルールに1ミリでも違反すれば、GitHub Desktopでのコミットは物理的に拒否されます。**

### 失敗の定義

- ❌ **「動くコード」を書くだけでは不十分**
- ✅ **「K-MADの構造を守りつつ動くコード」だけが正解**

**エラーが出た場合は、自分の能力ではなく、`governance_rules.json / .yaml,pipeline_definition.md` のルールに対する違反であることを認識、それに従ってください。**

---

## 3. 導入手順（3ステップ）

### Step 1: ファイルを配置

このスターターキットの全ファイルをプロジェクトルートに配置してください。

```
your-project/
├─ docs/
│  ├─ README.md（このファイル）
│  └─ AI_Controller_tutorial.md（詳細チュートリアル）
├─ src/
│  ├─ governance/
│  │  └─ governance_rules.json（「憲法」）
│  ├─ pipeline/
│  │  └─ pipeline_definition.md（「一本の道」定義）
│  └─ utils/
│     ├─ governance_gate.py（自動検問所）
│     ├─ snapshot_system.py（監査追跡システム）
│     ├─ central_layer_claim_arbiter.py（中央管理）
│     └─ setup.py（セットアップ自動化ユーティリティ）
└─ .git/（バージョン管理）
```

### Step 2: 初期セットアップ（2つの方法から選択）

どちらの方法もAIに指示するだけで完了します。  
**方法A（推奨）**: setup.pyをAIに使ってもらうと効率的  
**方法B**: AIに個別設定してもらう（従来の手順）

#### 方法A：setup.pyを使った一括セットアップ（推奨）

AIに以下を指示してください（コピペ用）：

**コピペ用：setup.py実行**
> `src/utils/setup.py` を実行して、初期セットアップを完了してください。

これで以下が自動的に設定されます：
- Gitリポジトリの初期化
- .gitignoreへの.snapshots/追加
- pre-commit hookの設定
- governance_rules.jsonのテンプレート生成

#### 方法B：個別設定（AIに一つずつ指示）

setup.pyを使わず、AIに個別の指示を出して設定します。

**コピペ用：Git Hook設定**
> GitHub Desktopでコミットする直前に、必ず `src/utils/governance_gate.py` を実行して、エラーがあればコミットを中止するように設定してください。Windowsの場合、`pre-commit`（Git hook）として動くようにしてください。さらに、GateがOKを出したときだけ `src/utils/snapshot_system.py` がスナップショットを撮るように連動させてください。

#### .gitignore設定（両方法共通で重要）

**スナップショットフォルダをGit管理から除外してください。**

理由：`.snapshots`フォルダはコード履歴を保存するため非常に大きくなります。これをGitHubにアップロードするとリポジトリが重くなります。

**AIに指示**：
```
「.snapshots フォルダを .gitignore に追加して」
```

**または人間が手動で追加**：
プロジェクトルートの`.gitignore`ファイルに以下を追加：
```
# K-MAD Snapshot System
.snapshots/
```

### Step 3: AIに指示

**人間の指示例**：
```
「〇〇機能を実装して」
「テストを実行して」
「エラーを修正して」
```

**AIが自動的に行うこと**：
1. 配布物（`governance_rules.json / .yaml,pipeline_definition.md`等）を読んで理解
2. K-MADルールに従ってコード実装
3. コミット時、`governance_gate.py`が自動検証
4. 違反があれば自己修正

**人間がすべきこと**：
- ✅ 「何を作るか」を指示
- ✅ テスト結果を見て「OK/NG」を判断
- ✅ エラーが出たら「直して」と指示

**人間がすべきでないこと**：
- ❌ コードの中身を読む
- ❌ エラーメッセージの技術的分析
- ❌ 配布物の内部構造の理解

---

## 4. ファイル構成

### 必須ファイル

| ファイル | 役割 |
|---------|------|
| `governance_gate.py` | 自動検問所（コミット時に全コードを検証） |
| `snapshot_system.py` | 状態保険システム（コード全文を圧縮保存、7日間保持、指定IDで完全復元可能） |
| `governance_rules.json / .yaml` | 自動検問所が守る「憲法」（ルール定義） |
| `central_layer_claim_arbiter.py` | 中央管理体制・意思決定機関（最終承認） |
| `pipeline_definition.md` | 「一本の道」定義（処理フロー仕様） |

### ドキュメント

| ファイル | 役割 |
|---------|------|
| `README.md` | このファイル（簡潔版） |
| `AI_Controller_tutorial.md` | 詳細チュートリアル |

---

## 5. よくある質問（FAQ）

**Q: エラーが出ました。どうすればいいですか？**
A: 人間は「直して」と指示するだけ。AIが`governance_rules.json / .yaml,pipeline_definition.md`を読んで修正します。

**Q: コードの中身を理解する必要がありますか？**
A: **ありません。** AIがすべて読んで実装します。

**Q: governance_gate.pyは何をしていますか？**
A: コミット時に全コードをスキャンし、K-MADルール違反を検出します。人間は中身を理解する必要はありません。

**Q: governance_rules.jsonの`execution_settings`とは何ですか？**
A: 検証の実行方法を制御する設定です。
- `verbose_output: true`（推奨）：詳細なログを出力（初心者向け）
- `stop_on_first_violation: false`（推奨）：すべての違反を一度に表示
- 慣れたら`stop_on_first_violation: true`に変更可能（最初の違反で即停止）

人間は設定ファイルのtrue/falseを変えるだけ。実装はAIに任せます。

---

## 6. トラブルシューティング

### コミットが拒否される場合

**人間の操作**：
```
「governance_gate.pyのエラーを修正して」
```

**AIが自動的に行うこと**：
1. エラーメッセージを解析
2. `governance_rules.json / .yaml,pipeline_definition.md`のルールを確認
3. 違反箇所を修正
4. 再度コミット

**人間は技術的な判断をする必要がありません。**

---

## 7. 次のステップ

1. **配布物を配置**（Step 1）
2. **Git Hookを設定**（Step 2）
3. **AIに指示**（Step 3）
4. **詳細はチュートリアルを参照**（`AI_Controller_tutorial.md`）

**これで、コードスキルゼロでも大規模アプリ開発が可能になります。**
