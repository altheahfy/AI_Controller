# AI Controller（K‑MADスターターキット）ユーザー向け手順書

この手順書は、配布物「AI Controller」を**実際に動かすための作業手順**です。  
本稿（第4章）は「理解用」です。作業するときは、基本的にこの手順書だけ見れば進められます。

---

## 0. はじめに：最重要ルール（ここだけは守る）
AI Controllerでは、あなたがやることは基本的に2つだけです。

1. **「コミット」ボタンを押す前に、ポイントだけ（コードではなくAIに説明させた内容）目で確認する**
2. **自動検問所（governance_Gate.py）のエラーが出たら、AIに直させる**

> **コミット＝「採用」**です。  
> ローカル保存は自由に試行錯誤してOK。**採用（コミット）だけは慎重に**。

---

## 1. 最初に用意するもの（5分）
- Windows PC（macでも可）
- VS Code
- GitHub Desktop（推奨）
- Copilot / 生成AI（VS Code内 or ブラウザ）
- 配布物一式（AI Controllerフォルダ）

---

## 2. まず新規フォルダに「AI Controller一式」を置く（1分）
1) 新しい空フォルダを作る（例：`my_app`）  
2) その中に配布物一式をそのままコピーする  
3) VS Codeでそのフォルダを開く

> ✅ ここでのゴール：**ファイルが「見える」状態**にするだけ。

---

## 3. AIに「読むだけ」をさせる（重要：まだ実装させない）
VS Code / Copilot に次を貼ってください（コピペ用）：

### コピペ用：最初の指示
> 次の配布物を**すべて読んで**ください。  
> - Readme.md  
> - K-MAD本稿.md（あれば）  
> - 配布物① governance_gate.py  
> - 配布物② snapshot_system.py  
> - 配布物③ governance_rules.json  
> - 配布物④ central_layer_claim_arbiter.py  
> - 配布物⑤ pipeline_definition.md
> - K-MAD_GUIDE.md 
>  
> **注意：この段階では、まだコード生成・編集を始めないでください。**  
> まず「理解しました」と宣言し、配布物の役割を短く要約してください。

> ✅ ここでのゴール：AIが**K-MADの主旨とこの仕組の中で開発することを理解する**こと。

---

## 4. GitHub Desktopでリポジトリを作る（必須）
> まだ自動検問所が働いていない状態では、AIは“自由に”前進できます。  
> **コミット拒否＝物理ブロック**を早めに作るのがコツです。

### 手順（GitHub Desktop）
1) GitHub Desktop を開く  
2) `File > Add local repository...` で2のフォルダを選択  
3) 「Create a repository」を選んで作成  
4) できたら最初のコミット（Initial commit）を作る

> ✅ ここでのゴール：**コミットの場所（採用のゲート）**を用意する。

---

## 5. 作ろうとするアプリの相談～（最初の山場）AIは“親切に”勝手に決め始めます
では、作ろうとするアプリでどんなことを実現したいのかを具体的にAIに説明しましょう。
そのうえで、それを実現するにはどんな部署（モジュール）と中央管理機関（central_layer_claim_arbiter.py）の組み合わせがいいか、相談してください。

### コピペ用：役割分担
> このアプリを構成するモジュールには、どんなガバナンスや内部統制が望ましいか考えたうえで（役割分担だけでなく職務分離と相
> 互牽制、情報の確認と中央管理機関の承認、など）、役割分担と職務分掌の案を出してください。勝手にファイルを書き換えず、まず私と『アプリの部署分け』について相談してください。
### コピペ用：パイプライン
> このアプリを構成するモジュールと中央管理機関にはどんなパイプラインが望ましいか、pipeline_definition.mdの内容をふまえたうえで考察し、案を出してください。勝手にファイルを書き換えず、まず私と『アプリの部署分け』について相談してください。

**この段階で、AIは高確率で次の行動に出ます（一応、コピペ用プロンプトにはそれを防止する文言を入れています）：**

- アプリの「部署（モジュール）」を勝手に決めて json を書き換えようとする
- 職務分掌（roles / capabilities）を勝手に決めて json を書き換えようとする
- パイプライン（処理順）を勝手に作ってpipeline_definition.mdを書き換えようとする
- それっぽく前へ進めようとする

> **ここは失敗ではありません。むしろ正常です。**  
> AIがあれこれ考えてくれるのは正解ですが、ここで大事なのは：

> **「勝手に決めた内容」を、そのまま採用しないこと**（＝コミットしない）

### ここであなたが見るべき2点（1分チェック）
AIが部署案やパイプライン案を出したら、次の2点だけ確認してください。

1) **部署の分担に意味があるか**  
   「一つの部署で処理が完結しない」が最大のコツです。下の例だと、4人が揃わないと計算結果は出ません。
   - a.「受付係は伝達はするが計算はしない」
   - b.「計算係は計算はするけどその結果を結果欄に書かない」
   - c.「確認係は結果がフォーマットに合っているか、重複がないかなど検査はするが承認や却下はしない」
   - d.「中央管理機関は上3つの内容が全て〇のときだけ承認して結果欄に出す」 
2) **処理のプロセス（一本道）が正しい順番になっていて重複がないか**  
   - 上記の例なら、abcdの順になっていないとおかしい   
   - ショートカット（検査を飛ばす近道）が入りそうならNG
   - パイプラインが「受付係パイプライン」「計算係パイプライン」「確認係パイプライン」「中央管理パイプライン」の4本になっていてその中のすべてに受付係、計算係、確認係、中央管理機関が入っていたら、無駄な重複。1本でいい。

> ✅ ここでのゴール：**思想（統治）を固定する**こと。  
> バグ防止ではなく、**設計の芯**を決める段階です。
> 内容が難しければ、それ自体AIに相談すればいいのです。

## 6. 憲法の更新
最終的に納得出来たら、governance_rules.jsonとpipeline_definition.mdを5で決めた内容でAIに更新してもらいましょう。

---

## 7. 自動検問所（governance_Gate.py）をコミット時に必ず動かすようセットする
AIに次を依頼してください（コピペ用）。

### コピペ用：自動検問所をコミット前に動かすとともに合格のとき「状態の写真」を撮影する設定
> GitHub Desktopでコミットする直前に、必ず `governance_gate.py` を実行して、エラーがあればコミットを中止するように設定してください。  
> Windowsの場合、`pre-commit`（Git hook）として動くようにしてください。  
> さらに、GateがOKを出したときだけ `snapshot_system.py` がスナップショットを撮るように連動させてください。  
> できたら「設定したファイル名」と「動作確認の方法」を教えてください。

> ✅ ここでのゴール：**「採用」だけが自動検問所を通る**状態にする。  
> 以後、あなたは「自動検問所がOKと言うか」だけ見ればよくなります。

---

## 8. 実際の会社組織（中央管理機関＋各部署）とパイプラインを作る
ここからは、AIと相談しながら進めてOKです。  
5で協議して決め、6で憲法に書き込んだ内容を元に、central_layer_claim_arbiter.pyを書き換え、各部署（モジュール）作り、接続してもらいましょう。

### コピペ用：パイプライン作成
> このcentral_layer_claim_arbiter.pyをベースにする。このアプリにおける ClaimType（データの種類）を定義し、部署間のデータの流れを pipeline_definition.md に沿って実装して。  

> ✅ ここでのゴール：**アプリケーションの基本構造ができる**こと。

---

## 9. 実装の回し方（以後ずっと同じ）
あなたがやることは基本これだけです。

1) AIに実装させる（ローカル保存は自由）  
2) コミット前に 自動検問所 を通す  
3) 自動検問所がNGなら、AIに直させる  
4) 自動検問所がOKなら、スナップショットが残る
5) もし憲法と自動検問所自体を変更の必要性を感じたら（新たに気づいたルールなど）、AIと相談のうえ慎重に進める

### コピペ用：自動検問所エラー時の指示テンプレ
> governance_gate.pyでエラーが出ています。  
> エラーメッセージを読み、配布物（governance_gate.py / governance_rules.json / pipeline_definition.md）に従って、ルール違反がなくなるまで修正してください。  
> 修正したら、再度コミット前チェックを通してください。

---

## 10. 最後に：見ないと壊れるわけではない。でも、見ると「自分のアプリ」になる
AIは、この手順でも“それっぽい正解”を出します。多くの場合、それは動きます。  
ただし、それがあなたの作りたい思想を反映した設計とは限りません。

> **コミット前の1分チェック**だけで、あなたは「設計者」になれます。  
> そこから先は、自動検問所が守ります。
